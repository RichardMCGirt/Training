<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin – Questions & Assignments</title>
  <style>
    :root{--bg:#f7f7fb;--card:#fff;--text:#1f2937;--muted:#6b7280;--brand:#2563eb;--bad:#dc2626;--ok:#059669;--border:#e5e7eb}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font:14px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"}
    h1,h2{margin:0 0 8px}
    .wrap{max-width:1100px;margin:30px auto;padding:0 16px}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .grid{display:grid;grid-template-columns:1fr 380px;gap:16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;box-shadow:0 1px 8px rgba(0,0,0,.04)}
    .muted{color:var(--muted)}
    .small{font-size:12px}
    input[type="text"], input[type="number"], textarea, select{
      width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;background:#fff
    }
    textarea{min-height:90px;resize:vertical}
    .btn{padding:8px 12px;border-radius:10px;border:1px solid var(--border);background:#fff;cursor:pointer}
    .btn:hover{border-color:#cbd5e1}
   
    .btn-ghost{background:#fff;border-color:transparent}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef2ff;color:#4f46e5;font-weight:600;margin:0 4px}
    .stage{min-height:140px}
    #moduleGroups .mod{border:1px solid var(--border);border-radius:12px;margin:8px 0;overflow:hidden;background:#fff}
    #moduleGroups .mod-head{display:flex;justify-content:space-between;align-items:center;width:100%;padding:10px 12px;background:#f9fafb;border:0;cursor:pointer}
    #moduleGroups .mod-count{background:#eff6ff;color:#1d4ed8;border-radius:999px;padding:2px 8px;font-weight:700}
    #moduleGroups .mod-body{padding:8px 12px}
    .qline{display:grid;grid-template-columns:1fr auto;gap:8px;padding:8px 0;border-bottom:1px dashed var(--border)}
    .qline:last-child{border-bottom:0}
    .chip{display:inline-block;background:#eef2ff;border:1px solid #e0e7ff;border-radius:999px;padding:2px 8px;margin:2px 4px 2px 0}
    .hint{color:#6b7280}
    .opt{display:flex;gap:8px;align-items:center;margin:6px 0}
    .opt .mark{display:flex;gap:4px;align-items:center}
    .section-title{font-weight:700;margin:4px 0 8px}
    .divider{height:1px;background:var(--border);margin:10px 0}
    .controls .row{justify-content:space-between}
    .toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:#111827;color:#fff;padding:10px 14px;border-radius:10px;opacity:0;pointer-events:none;transition:.25s}
    .toast.show{opacity:1;pointer-events:auto}
    .flags{display:flex;gap:10px;flex-wrap:wrap}
    .flags label{display:flex;align-items:center;gap:6px}
    
    .two-col{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="row" style="justify-content:space-between">
      <h1>Admin</h1>
      <div class="row">
        <input id="search" type="text" placeholder="Search questions, modules, slide IDs…" style="min-width:280px">
        <label class="muted"><input id="fltActive" type="checkbox" checked> Active</label>
        <label class="muted"><input id="fltInactive" type="checkbox" checked> Inactive</label>
        <button id="btnRefresh" class="btn">Refresh</button>
      </div>
    </div>

    <div class="grid" style="margin-top:12px">
      <section class="card">
        <div class="row" style="justify-content:space-between">
          <h2>Questions</h2>
          <div id="listStatus" class="muted small">–</div>
        </div>
        <div id="moduleGroups" class="stage"><div class="muted">Loading…</div></div>
      </section>

      <aside class="card">
        <h2>Create / Edit Question</h2>
        <div class="divider"></div>

        <label class="section-title">Question Type</label>
        <select id="questionType">
          <option value="MC">Multiple Choice</option>
          <option value="FITB">Fill in the Blank</option>
        </select>

        <div class="two-col" style="display: none;">
          <div>
            <label class="section-title">Slide ID (optional)</label>
            <input id="slideId" placeholder="e.g., g123..._0_5" />
          </div>
          <div>
            <label class="section-title">Order</label>
            <input id="order" type="number" value="1" />
          </div>
              <label class="section-title" style="margin-top:8px">Question ID</label>
        <input id="questionId" placeholder="q_auto…" />
        </div>

    

        <label class="section-title" style="margin-top:8px">Question Text</label>
        <textarea id="questionText" placeholder="Type the question…"></textarea>

        <div class="two-col" style="margin-top:8px">
          <div>
            <label class="section-title">Module</label>
            <select id="moduleSelect">
              <option value="">(none)</option>
            </select>
            <div id="moduleChips" class="muted small" style="margin-top:6px"></div>
          </div>
          <div>
            <label class="section-title"></label>
            <input id="moduleInput" placeholder="e.g., Safety, Basics, Deck-1" />
          </div>
        </div>

        <!-- Multiple Choice block -->
        <div id="mcBlock" style="margin-top:12px">
          <div class="row" style="justify-content:space-between">
            <label class="section-title">Options</label>
            <div class="row">
              <button id="btnAddOption" class="btn">+ Option</button>
              <button id="btnClearOptions" class="btn">Clear</button>
            </div>
          </div>
          <div id="options"></div>
          <div class="hint small" style="margin-top:4px"></div>
        </div>

        <!-- Fill in the Blank block -->
        <div id="fitbBlock" style="margin-top:12px; display:none">
          <label class="section-title">Accepted Answers</label>
          <textarea id="fitbAnswers" placeholder=""></textarea>
          <div class="flags" style="margin-top:6px">
            <label><input id="fitbUseRegex" type="checkbox"> Treat as Regular Expressions</label>
            <label><input id="fitbCaseSensitive" type="checkbox"> Case Sensitive</label>
          </div>
          <div class="hint small" style="margin-top:4px">
          </div>
        </div>

        <div class="divider"></div>

        <div class="row" style="justify-content:flex-end">
          <button id="btnReset" class="btn">Reset</button>
          <button id="btnSave" class="btn btn-primary">Save</button>
        </div>
      </aside>
    </div>
<!-- Module → Slides/GAS Mapping (Admin) -->
<section class="card" id="modmap-root" style="margin-top:16px">
  <h2>Module → Slides &amp; GAS</h2>
  <div class="divider"></div>

  <form id="modmap-form">
    <input type="hidden" id="modmap-id" />
    <label class="section-title">Module</label>
    <input id="modmap-module" placeholder="Exact module name (matches Questions → Module)" />

    <div class="muted small" style="margin:6px 0">Quick pick from known modules:</div>
    <div id="modmap-quick" class="muted small" style="margin-bottom:8px"></div>

    <label class="section-title" style="margin-top:8px">Google Slides Presentation ID</label>
    <input id="modmap-pid" placeholder="e.g., 1lsNam3OMuol_..." />

    <label class="section-title" style="margin-top:8px">GAS Web App URL</label>
    <input id="modmap-gas" placeholder="https://script.google.com/macros/s/XXX/exec" />

    <div class="row" style="margin-top:8px">
      <label class="muted"><input id="modmap-active" type="checkbox" checked> Active</label>
      <button class="btn" type="submit">Save</button>
      <span id="modmap-status" class="muted small"></span>
    </div>
  </form>

  <div class="divider"></div>
  <div class="section-title">Saved mappings</div>
  <div id="modmap-list" class="stage"><div class="muted">Loading…</div></div>
</section>

    <section class="card" style="margin-top:16px">
      <h2>Assign Modules to Job Titles</h2>
      <div class="muted small">Select one or more Titles, then pick a Module above (in the question form) and click Save Assignment.</div>
      <div class="divider"></div>
      <div class="two-col">
        <div>
          <label class="section-title">Titles</label>
          <select id="titleSelect" multiple size="10" style="min-height:240px"></select>
          <div class="row" style="margin-top:8px">
            <button id="btnReloadTitles" class="btn">Reload Titles</button>
          </div>
        </div>
        <div>
          <label class="section-title">Assigned Modules (shared across selected Titles)</label>
          <div id="moduleChecklist"></div>
          <div class="row" style="margin-top:10px; gap:10px">
            <button id="btnSaveAssignment" class="btn btn-primary">Save Assignment</button>
            <button id="btnUnassignModule" class="btn btn-danger" title="Remove the selected Module from all chosen Titles">Unassign Selected Module</button>
          </div>
          <div id="assignStatus" class="muted small" style="margin-top:8px">Select titles to begin.</div>
        </div>
      </div>
    </section>
  </div>

  <div id="toast" class="toast"><span id="toastMsg">Saved</span></div>

  <script src="admin.js"></script>
<script src="./modules.js"></script>
<script src="./admin-modules.js"></script>
</body>
</html>
